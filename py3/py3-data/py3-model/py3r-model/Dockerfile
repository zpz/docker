# Dockerfile for image 'zppz/py3r-model:20160607'

#==================================
# Generated by 'build.sh'.
#
# DO NOT EDIT.
#==================================

# In the intended use cases of this image,
# Python is the primary deveopment environment,
# whereas R is called from Python to make use of certain
# specialized R packages.
#
# One-way Python/R inter-op, namely calling R from Python,
# is provisioned by the Package package 'rpy2'.

FROM zppz/py3-model:20160607

USER root


#-------------
# R

# ENV R_VERSION 3.2.4-revised-1
# To find the latest R version available, in a container launched on the 'base' image above, do this:
# > echo "deb http://http.debian.net/debian sid main" > /etc/apt/sources.list.d/debian-unstable.list
# > apt-get update
# > apt-cache -t unstable search r-base
# > apt-cache -t unstable show r-base
#
# RUN echo "deb http://http.debian.net/debian sid main" > /etc/apt/sources.list.d/debian-unstable.list \
#     && apt-get update \
#     && apt-get install -y --no-install-recommends \
#         build-essential \
#         pkg-config \
#         libreadline6 \
#         libreadline6-dev \
#     \
#     && apt-get install -t unstable -y --no-install-recommends \
#         r-base=${R_VERSION} \
#         r-base-dev=${R_VERSION} \

ENV R_VERSION 3.1.1-1

RUN apt-get update \
    && apt-get install -y --no-install-recommends \
        build-essential \
        pkg-config \
        libreadline6 \
        libreadline6-dev \
    \
    && apt-get install -y --no-install-recommends \
        r-base=${R_VERSION} \
        r-base-dev=${R_VERSION} \
    && echo 'install.packages(\
        c("futile.logger", "testthat"), \
        repos="http://cran.us.r-project.org", \
        dependencies=c("Depends", "Imports"), \
        clean=TRUE, keep_outputs=FALSE)' > /tmp/packages.R \
    && Rscript /tmp/packages.R \
    \
    && pip3 install --no-cache-dir --upgrade \
        'rpy2==2.7.8' \
    \
    && apt-get purge -y --auto-remove \
        build-essential \
        pkg-config \
        libreadline6-dev \
        r-base-dev \
    && rm -rf /var/lib/apt/lists/* /tmp/* \
    && apt-get -y autoremove \
    && apt-get clean


#-------------
# R dev tools

RUN apt-get update \
    && apt-get install -y --no-install-recommends \
        build-essential \
        pkg-config \
    \
    && echo 'install.packages(\
        c("roxygen2"), \
        repos="http://cran.us.r-project.org", \
        dependencies=c("Depends", "Imports"), \
        clean=TRUE, keep_outputs=FALSE)' > /tmp/packages.R \
    && Rscript /tmp/packages.R \
    \
    && apt-get purge -y --auto-remove \
        build-essential \
        pkg-config \
    && rm -rf /var/lib/apt/lists/* /tmp/* \
    && apt-get -y autoremove \
    && apt-get clean


#-------------
# startup

USER ${USER}
WORKDIr ${HOME}

CMD ["/bin/bash"]
